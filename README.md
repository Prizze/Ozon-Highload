# Ozon Highload

## 1. Тема, аудитория и функционал

### Тема

**Ozon** - один из крупнейших российских маркетплейсов, где тысячи продавцов предлагают широкий ассортимент товаров от электроники до продуктов питания.

### Функционал MVP

1. Профиль пользователя
    - Регистрация
    - Авторизация
    - Создание, редактирование, удаление товара
2. Товары
    - Поиск товаров
    - Фильтры и категории товаров
    - Карточка товара с описанием
3. Лента с рекомендуемыми товарами
    - Главная страница
    - Рекомендации в карточке товара
4. Отзывы
    - Создание, редактирование, удаление отзыва на купленный товар
    - Просмотр рейтинга товара
5. Корзина товаров
    - Добавление, удаление товара. Изменение количества товара
    - Подсчет итоговой суммы
6. Заказ
    - Оформление заказа
    - Выбор адреса и способа доставки
    - Просмотр статуса заказа
    - Просмотр истории заказов
    - Выбор способа оплаты заказа

### Аудитория

**Анализ трафика**
- MAU - **60.5M** [^1]
- DAU - **22M** [^2]
- Заказов в день - **5.9M** [^1]
- Заказов за квартал - **539M** [^1]
- Товаров на витрине - **370M** [^3]
- Количество продавцов - **600K** [^3]
- Поисковых запросов в месяц - **1.18B** [^4]

**Географическое распределение** [^5]
|Страна | Распределение трафика|
| :- | :- |
| Россия | 94.69% |
| Беларусь | 0.81% |
| Нидерланды| 0.66% |
| Германия | 0.63% |

**Распределение аудитории по полу** [^2]

* Мужчины - **45%**
* Женщины - **55%**

**Распределение аудитории по возрасту** [^4]

<div align="center">

![Круговая диаграмма распределения аудитории по возрасту](/img/Theme/age-distribution.png)

</div>



## 2. Расчет нагрузки

### Исходные данные

| Метрика | Значение |
|:- | :- |
| MAU | 60.5M |
|DAU|22M |
|Частотность заказов в год на пользователя | 29.9 [^6]|
| Количество поисковых запросов в месяц| 1.18B  |
| MAU на конец 1 квартала 2025 г.|58.1M [^6] |

Данные из веб-приложения Ozon:
- При поиске товара прогружается 12 товаров за раз.
- При просмотре ленты рекомендаций прогружается 10 товаров за раз.
- При просмотре отзывов прогружается по 8 отзывов за раз.

### Продуктовые метрики

#### Рассчитаем среднее количество действий пользователя по типам в день

Заказы:
- Учитывая, что в среднем пользователь делает 29.9 заказов в год, то в день он делает $\frac{29.9}{365} = \mathbf{0.082}$ заказа
- Предположение: На каждый заказ пользовтель заходит 3 раза в историю заказов: 1 раз при оплате, второй раз при доставке и еще раз для проверки во время его доставки. Тогда просмотр истории заказов в день: $0.082 * 3 = \mathbf{0.246}$

Поиск:

- Если в месяц происходит 1.18B поисковых запросов, то количество запросов на человека в день: $\frac{1.18 * 10^9}{30*DAU} = \frac{1.18 * 10^9}{30 * 22 * 10^6} = \mathbf{1.78}$

Корзина:

- Конверсия добавления товара в корзину из поиска в среднем 15.8% (взято с аналитики поиска [Ozon Seller](https://seller.ozon.ru/app/analytics/what-to-sell/all-queries) [^7]. Значение рассчитывалось как среднее по первым 50 типам запроса). Тогда количество добавлений товаров в корзину: $1.78 * 0.158 = \mathbf{0.28}$
- Предположение: пользователь смотрит корзину только перед заказом, тогда возьмем количество просмотров корзины равным количеству заказов - $\mathbf{0.082}$

Товары:
- Исходя из данных аналитики поиска с Ozon Seller (аналитика поисковых запросов)[^7] в среднем за поиск показывается 79 товаров. Учитывая, что прогружается сразу 12 товаров, то количество подгрузок товара при поиске в день: $\frac{79}{12} * 1,78 = \mathbf{11.7} $
- По данным Ozon Seller (аналитика популярных товаров) [^9] в среднем на 544372 просмотра товаров в поиске открывается 183401 карточка. То есть на $\frac{544372}{12} = 45364$ прогрузки товаров в поиске просматривается 183401 карточка. Тогда на каждую подгрузку товаров открыватеся $\approx 4$ карточки. Количество просмотренных карточек товара в день: $11.7 * 4 = \mathbf{46.8}$

Лента:
- В среднем пользователь заходит $\frac{DAU * 30}{MAU} = \frac{22M * 30}{60.5M} = 10.9$ раз в месяц. Тогда в день он заходит $\frac{10.9}{30} \approx \frac{1}{3}$ раз. Количество показов товаров в ленте возьмем равным количеству показов товаров при поиске, умноженным на 4: $79 * 4 = 316$. Тогда количество подгрузок ленты: $\frac{316}{10} * \frac{1}{3} = \mathbf{10.5}$


Отзывы:
- Отзывы к заказам оставляет только 10% покупателей [^8]. Тогда количество оставленных отзывов в день: $0.082 * 0.1 = \mathbf{0.0082}$
- При просмотре товара 95% пользователей читают отзывы [^8]. Предположение: Пользователь просматрвивает 16 отзывов при просмотре товара, то есть отзывы подгружаются два раза; пользователь читает отзывы на 3 самых лучших варианта. Также в корзину в среднем переходит 12.36% товаров после просмотра карточки товара[^9], то есть какой-то из трех лучших. Тогда количество подгрузок отзывов в день: $46.8 * 3 * 0.126 = \mathbf{17.6}$


Профиль:
- Во втором квартале 2025 г. активных покупателей было 60.5M, в первом квартале - 58.1M. Прирост за три месяца: $60.5M - 58.1M = 2.4M$. Значит в день регистрируется примерно $\frac{2.4 * 10^6}{90} = \mathbf{26K}$ людей

Продавцы:
- Предположение: Каждый продавец выставляет 0.5 товара в день, тогда в месяц получается $600K * 0.5 * 30 = 9M$, тогда в год будет $108M$  новых товаров. Учитывая, что всего товаров на момент 2023 г. было 370M [^10], можно сказать, что прирост количества товаров реалистичный.

| Метрика | Значение (действий в день) |
|:- |:- |
|Заказов в день | 0.082|
| Просмотр истории заказов | 0.246 |
| Поиск | 1.78 |
| Добавление в корзину | 0.28 |
| Просмотр корзины | 0.082 |
| Подгрузка товаров в поиске (по 12)| 11.7 |
| Просмотр карточки товара | 46.8 |
| Подгрузка рекомендуемых товаров в ленте | 10.5 |
| Добавление отзыва к товару| 0.0082 |
| Подгрузка отзывов к товару (по 8) | 17.6|
| Создание нового товара (только продавцы)| 0.5 |
| - | - |
| Новых регистраций| 26K |

#### Рассчитаем cредний размер хранилища пользователя

> В среднем в Ozon картинка после сжатия весит $\mathbf{12Кб}$

Пользователь:
- Для пользователя нужно хранить Аватарку, Имя, Фамилию, id: 12 Кб + 14 байт + 20 байт + 4 байта $\approx 12$ Кб

Корзина:
- Для хранения одного товара в корзине нужно хранить user_id, product_id, quantity, price: 4 байта + 8 байт + 1 байт + 4 байта $= 17$ байт

Заказ:
- Для хранения товара нужно хранить order_id, user_id, status, price, product_id (по количесвтву товаров в заказе), addres пункта выдачи, delivered_at, created_at: 16 байт + 4 байта + 1 байт + 4 байта + 8 байт(по количесвтву товаров в заказе) + 100 байт + 8 байт + 8 байт $ = 157 $ байт

Товар: 
- Для хранения товара нужно хранить id, описание, 8 фото товара, price = 4 байта + 2 Кб + 8 * 12 Кб + 4 байта $\approx 98$ Кб

Отзыв:
- Для хранения отзыва нужно хранить id, user_id, product_id,текст (150 символов): 16 байт + 4 байта + 4 байта + 300 байт = 324 байта

| Метрика | Размер (Гб) |
| :- | :- |
| 1 пользователь | $12 * 10^{-6}$|
| 1 товар в корзине | $17 * 10^{-9}$|
| 1 заказ| $157 * 10^{-9}$|
| 1 товар| $98 * 10^{-6}$|
| 1 отзыв| $324 * 10^{-9}$|

Теперь посчитаем какой прирост будет у данных за месяц

Пользователь:
- Как уже было описано выше: за квартал прирост пользователей составляет 2.4M, то есть 800K в месяц. Тогда для их хранения нужно: $800K * 12\ Кб = 9.1\ Гб$

Заказы:
- Для хранения заказов за месяц: $0.083 * 30 * 60.5M * 157\ байт = 22Гб$

Товары:
- Учитывая, что по предположению продавцы выставляют 0.5 товаров в день и всего 600K продавцов, то для хранения товаров за месяц: $600K * 0.5 * 30 * 98\ Кб = 841\ Гб$

Отзывы:
- Для хранения отзывов за месяц: $0.0083 * 30 * 60.5M * 324\ байта = 4.5\ Гб$

| Метрика | Прирост в месяц (Гб) |
| :- | :- |
| Пользователи | 9.1|
| Заказы | 22|
| Товары | 841|
| Отзывы | 4.5|

### Технические метрики

#### Рассчитаем RPS
Благодаря данным, полученным при расчете среднего количество действий пользователя по типам в день, можно легко расчитать PRS для разных запросов. Нужно домножить каждое значение на DAU(22M) и разделить на 86400 (секунд в дне). Количество регистраций нужно просто поделить на 86400.

Пиковое RPS считается как утроенное произведение среднего RPS.

| Метрика |RPS (средний) | RPS (пиковый)|
| :- | :-  | :- | 
| Регистрация | 0.3 | 0.9|
| Создание товара | 3.5 | 10.5 |
| Поиск | 455.7 | 1367 |
| Карточка товара | 11916 | 35750 |
| Подгрузка товаров в поиске | 2979 | 8937 |
| Подгрузка товаров в ленте рекомендаций| 2673 | 8020 |
| Подгрузка отзывов к товару | 4481 | 13444 |
| Заказ | 21 | 63 |
| Просмотр истории заказов| 63 | 249 |
| Добавление товара в корзину | 71 | 213 | 
| Просмотр корзины | 21 | 63 |

#### Рассчитаем сетевой трафик

 Для расчета будем использовать уже посчитанное раннее среднее количество действий пользователя по типам в день

Подбор товаров в поиске:
- Запрос весит 18 Кб. Также подгружается 12 картинок (по одной на каждый товар). Тогда общий трафик: 18 Кб + 12 * 12 КБ $ = 162\ Кб$
- За сутки: $\frac{11.7 * 162 * 22 * 10^6}{1024*1024} = 39767\ Гбайт/сутки$

Карточка товара:
- На одну карточку товара - 36 Кб и ~8 картинок. Общий трафик: 36 Кб + 8 * 12 Кб $ = 132 Кб$
- За сутки: $\frac{46.8 * 132 * 22 * 10^6}{1024*1024} = 129611\ Гбайт/сутки$

Поиск:
- На один запрос поиска нужно $1.1\ Кб$
- За сутки: $\frac{1.78 * 1.1 * 22 * 10^6}{1024*1024} = 41\ Гбайт/сутки$

Подгрузка отзывов:
- Для загрузки отзывов необходимо $17.9\ Кб$.
- За сутки: $\frac{17.6 * 17.9 * 22 * 10^6}{1024*1024} = 6609\ Гбайт/сутки$

Подгрузка товаров в ленте рекомандаций:
- Один запрос весит 15 Кб и 10 картинок. Общий трафик: 15 Кб + 10 * 12 $ = 135\ Кб$
- За сутки: $\frac{10.5 * 135 * 22 * 10^6}{1024*1024} = 29740\ Гбайт/сутки$

Остальные запросы  не существенно влияют на сеть.

 Чтобы получить трафик в Гбит/с, нужно разделить дневной трафик на 86400 и умножить на 8. Для получения пикового потребления умножим значение среднего потребления на 3, аналогично рассчету PRS

| Метрика | Гбит/с (среднее) | Гбит/c (пиковое)| Гбайт/сутки|
| :- | :-  | :- | :- |
| Поиск | 0.004 | 0.012  | 41 |
| Подгрузка товаров в поиске | 3.7  | 11.1 | 39767 |
| Карточка товара | 12 | 36 | 129611 |
| Подгрузка отзывов | 0.6 | 1.8 | 6609 |
| Подгрузка товаров в ленте рекомандаций | 2.75 | 8.25 | 29740 |

## N. Список источников
[^1]: [Ozon Tech](https://ozon.tech) 
[^2]: [Mediascope: Медиапотребление и e-commerce в России](https://mediascope.net/upload/iblock/4fe/y85jka00l645h8f5qaw2zd52fhxrz4x3/Ecom%202024_Mediascope.pdf)
[^3]: [Ozon Comp](https://corp.ozon.ru)
[^4]: [Mediascope: Поиск в E-COM](https://mediascope.net/upload/iblock/d6d/tv0d1kn73z81az3vtvpv0og3io5s9z8j/Mediascope_поиск%20в%20e-com.pdf)
[^5]: [Similarweb ](https://pro.similarweb.com)
[^6]: [Финансовые результаты за 2 кв. 2025 года](https://cdn1.ozone.ru/s3/sigma-static-e93b3ad2-6f0b-4ad0-a53e-192ad6466704/Финансовые%20результаты%20за%202%20кв.%202025%20года.pdf?ts=1754581943712)
[^7]: [Ozon Seller - аналитика поисковых запросов](https://seller.ozon.ru/app/analytics/what-to-sell/all-queries) \*
[^8]: [Managing Your Online Reputation: Key Online Review Statistics](https://www.ileeline.com/online-review-statistics/)
[^9]: [Ozon Seller - аналитика популярных товаров](https://seller.ozon.ru/app/analytics/what-to-sell/ozon-bestsellers)
[^10]: [Ozon - годовой отчет 2023](https://cdn1.ozone.ru/s3/sigma-static-e93b3ad2-6f0b-4ad0-a53e-192ad6466704/Ozon_Annual_Report_2023_RUS.pdf?ts=1734619098494)

\* Пример аналитики поиска с Ozon Seller:

![Аналитика Ozon Seller](/img/SourcesList/ozon-seller.png)